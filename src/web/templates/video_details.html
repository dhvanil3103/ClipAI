{% extends "base.html" %}

{% block title %}{{ video.title }} - Clips{% endblock %}

{% block content %}
<div class="back-link">
    <a href="{{ url_for('index') }}" class="btn btn-small">‚Üê Back to Videos</a>
</div>

<div class="card">
    <h2 style="margin-bottom: 1rem; color: #333;">{{ video.title }}</h2>
    
    <div class="meta-info">
        <div class="meta-item">
            <div class="meta-label">Channel</div>
            <div class="meta-value">{{ video.uploader }}</div>
        </div>
        
        <div class="meta-item">
            <div class="meta-label">Duration</div>
            <div class="meta-value">{{ video.duration|duration }}</div>
        </div>
        
        <div class="meta-item">
            <div class="meta-label">View Count</div>
            <div class="meta-value">{{ "{:,}".format(video.view_count) if video.view_count else 'Unknown' }}</div>
        </div>
        
        <div class="meta-item">
            <div class="meta-label">Upload Date</div>
            <div class="meta-value">{{ video.upload_date or 'Unknown' }}</div>
        </div>
        
        <div class="meta-item">
            <div class="meta-label">Processed</div>
            <div class="meta-value">{{ video.created_at|datetime }}</div>
        </div>
        
        <div class="meta-item">
            <div class="meta-label">Status</div>
            <div class="meta-value">
                {% if video.status == 'metadata_generated' or video.status == 'clips_generated' %}
                    <span class="status status-success">‚úÖ Complete</span>
                {% elif video.status == 'clips_selected' %}
                    <span class="status status-warning">‚ö†Ô∏è Analysis Only</span>
                {% else %}
                    <span class="status status-error">‚ùå {{ video.status|title }}</span>
                {% endif %}
            </div>
        </div>
    </div>
    
    {% if video.url %}
    <div style="margin-top: 1rem;">
        <a href="{{ video.url }}" target="_blank" class="btn" style="background: #ff0000;">
            üîó Watch Original Video
        </a>
    </div>
    {% endif %}
</div>

{% if clips %}
    <h3 style="margin-bottom: 1.5rem; color: #333;">üé¨ Generated Clips ({{ clips|length }})</h3>
    
    <div class="clip-grid">
        {% for clip in clips %}
        <div class="card">
            <div style="position: relative;">
                <!-- Thumbnail (shown by default) -->
                {% if clip.thumbnail_url %}
                <img 
                    id="thumbnail-{{ loop.index }}" 
                    src="{{ clip.thumbnail_url }}" 
                    alt="Clip {{ clip.index }} thumbnail"
                    class="thumbnail"
                    onclick="playVideo('video-{{ loop.index }}', 'thumbnail-{{ loop.index }}')"
                    style="display: block;"
                />
                {% endif %}
                
                <!-- Video player (hidden by default) -->
                <video 
                    id="video-{{ loop.index }}"
                    class="video-player" 
                    controls 
                    preload="metadata"
                    style="display: none;"
                >
                    <source src="{{ clip.video_url }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                
                <!-- Play button overlay -->
                {% if clip.thumbnail_url %}
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px;" onclick="playVideo('video-{{ loop.index }}', 'thumbnail-{{ loop.index }}')">
                    ‚ñ∂Ô∏è
                </div>
                {% endif %}
            </div>
            
            <div class="clip-info">
                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="color: #333;">Clip {{ clip.index }}</h4>
                    <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                        {{ clip.segment_data.segment_type|title }}
                    </span>
                </div>
                
                {% if clip.metadata and clip.metadata.title %}
                <div class="clip-title">{{ clip.metadata.title }}</div>
                {% endif %}
                
                {% if clip.metadata and clip.metadata.description %}
                <div class="clip-description">{{ clip.metadata.description }}</div>
                {% endif %}
                
                <div style="font-size: 12px; color: #666; margin-bottom: 0.5rem;">
                    <strong>Duration:</strong> {{ "%.1f"|format(clip.segment_data.end_time - clip.segment_data.start_time) }}s
                    <br>
                    <strong>Score:</strong> {{ "%.1f"|format(clip.segment_data.score) }}/10
                    <br>
                    <strong>Time:</strong> {{ "%.1f"|format(clip.segment_data.start_time) }}s - {{ "%.1f"|format(clip.segment_data.end_time) }}s
                    <br>
                    <strong>File Size:</strong> {{ "%.1f"|format(clip.file_size_mb) }}MB
                </div>
                
                {% if clip.segment_data.reasoning %}
                <div style="font-size: 12px; color: #666; font-style: italic; margin-bottom: 0.5rem;">
                    "{{ clip.segment_data.reasoning }}"
                </div>
                {% endif %}
                
                {% if clip.metadata and clip.metadata.hashtags %}
                <div class="hashtags">
                    {% for hashtag in clip.metadata.hashtags %}
                    <span class="hashtag">#{{ hashtag }}</span>
                    {% endfor %}
                </div>
                {% endif %}
                
                <div style="margin-top: 1rem; display: flex; gap: 8px; flex-wrap: wrap;">
                    <a href="{{ url_for('download_clip', video_id=video.video_id, filename=clip.filename) }}" class="btn btn-small btn-download">
                        üíæ Download
                    </a>
                    
                    {% if clip.metadata %}
                    <button class="btn btn-small" onclick="copyMetadata({{ loop.index }})">
                        üìã Copy Metadata
                    </button>
                    {% endif %}
                </div>
                
                <!-- Hidden metadata for copying -->
                {% if clip.metadata %}
                <div id="metadata-{{ loop.index }}" style="display: none;">
Title: {{ clip.metadata.title }}

Description: {{ clip.metadata.description }}

Hashtags: {% for hashtag in clip.metadata.hashtags %}#{{ hashtag }} {% endfor %}

Duration: {{ "%.1f"|format(clip.segment_data.end_time - clip.segment_data.start_time) }}s
Score: {{ "%.1f"|format(clip.segment_data.score) }}/10
Type: {{ clip.segment_data.segment_type|title }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div style="margin-top: 3rem; padding: 2rem; background: white; border-radius: 12px; text-align: center;">
        <h3 style="margin-bottom: 1rem; color: #333;">üì± Platform-Specific Tips</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; text-align: left;">
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                <h4 style="color: #ff0000; margin-bottom: 0.5rem;">üì∫ YouTube Shorts</h4>
                <p style="font-size: 14px; color: #666;">Upload as vertical video (9:16). Add engaging title and relevant hashtags. Keep it under 60 seconds for best performance.</p>
            </div>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                <h4 style="color: #e4405f; margin-bottom: 0.5rem;">üì∏ Instagram Reels</h4>
                <p style="font-size: 14px; color: #666;">Use trending audio, add text overlays, and include relevant hashtags. Post during peak hours for maximum reach.</p>
            </div>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 6px;">
                <h4 style="color: #000; margin-bottom: 0.5rem;">üéµ TikTok</h4>
                <p style="font-size: 14px; color: #666;">Hook viewers in first 3 seconds. Use trending hashtags and sounds. Engage with comments quickly.</p>
            </div>
        </div>
    </div>
    
{% else %}
    <div class="empty-state">
        <h2>üé¨ No Clips Generated</h2>
        <p>This video was processed but no clips were generated. This could be due to:</p>
        <ul style="text-align: left; max-width: 400px; margin: 1rem auto;">
            <li>No engaging content found with score ‚â•7.0</li>
            <li>Video processing failed</li>
            <li>Transcript quality issues</li>
        </ul>
    </div>
{% endif %}

<script>
function copyMetadata(clipIndex) {
    const metadataDiv = document.getElementById('metadata-' + clipIndex);
    if (metadataDiv) {
        navigator.clipboard.writeText(metadataDiv.innerText).then(function() {
            // Show success feedback
            const button = event.target;
            const originalText = button.innerText;
            button.innerText = '‚úÖ Copied!';
            button.style.background = '#28a745';
            
            setTimeout(function() {
                button.innerText = originalText;
                button.style.background = '#667eea';
            }, 2000);
        }).catch(function(err) {
            alert('Failed to copy metadata: ' + err);
        });
    }
}
</script>

{% endblock %} 